# 5A88 系統介紹

## 常用連結

1. [嘉義縣網5A88簡介](http://140.123.4.19/Site/kc11533/Blog)

## 系統介紹

1. 多功能開機與維護選單
2. 支援多種系統
   1. Windows
   2. Linux
   3. Android
3. 內建 Windows 自我還原功能
   1. VHD 差異備份技術
4. 使用者資料碟

## 開機選單

1. 微軟作業系統
2. Linux 作業系統
3. 維護與還原

選單分為兩層

1. 第一層: 主功能表 -- 操作選單(學生操作用)
2. 第二層: 維護與還原功能表－維護選單(教師管理用)

Windows 系統虛擬磁碟

1. Windows 樣板(系統母碟，檔名為 XXX.vhdx): 純放基本系統、Office等套裝軟體。一般來說不會主動更動。
2. 一級副本(安裝子碟，檔名為 XXX_chd.vhdx): 存放各部門自行安裝的軟體與更新檔
3. 二級副本(操作暫存，檔名為 xxx_tmp.vhdx): 儲存使用者操作過程中產生的異動檔，還原會清除。 

基本的判斷原則是：

從第一層操作選單進入Windows時，系統會經由二級複本檔案開機，所有的操作只會影響到二級複本的內容
從第二層維護選單進入Windows時，系統會經由一級複本檔案開機，所有的操作除了會影響到一級複本的內容外，還會造成二級複本失效
不論從第一層操作選單或第二層維護選單執行「還原學生用系統」功能，會清除二級複本並重建
不論一級複本有任何異動(即使只是開／關機操作)，請執行一次「還原學生用系統」功能，將二級複本重建

## 製作 5A88 隨身碟

1. 2Gb 以上格式化成NTFS的隨身碟
2. 複製以下檔案
   1. default   
   2. grldr及grldr.mbr
   3. menu.lst
   4. BOOTICEx64.exe及BOOTICEx86.exe(待會兒會用到)
   5. NTBOOT資料夾(全部Copy)
3. 隨身碟底下建一個vhdos 資料夾
4. 安裝 grub4dos 開機管理程式，執行 BOOTICEx64.exe，選擇隨身碟。
5. 基於相容性，Linux系統映像檔是放在採用FAT32格式的C:磁碟下的VHDOS目錄裡

## 利用 BOOTICE 建立副本檔

1. 磁片鏡像處理，選擇 **差分VHD**。
2. 設定父檔: \vhdos\Win10X64.vhdx，子檔:  \vhdos\Win10X64_chd.vhdx。
3. 再用一級複本當作父檔，再用差分做一份子檔為二級複本。設定父檔: \vhdos\Win10X64_chd.vhdx，子檔:  \vhdos\Win10X64_tmp.vhdx。

## 設定開機選單 menu.lst

在menu.lst檔案中，每個作業系統啟動選單是由以[iftitle]判斷指令起啟、前後以空行隔開的段落來定義，以微軟Windows作業系統為例，基本上包含以下幾行：

# 註解：以井號開頭者表示該行為註解，不會被執行；通常用於放置說明文字，或是停用某個功能指令。

iftitle [find --參數 檔案路徑／檔案名稱]  選單文字 \n　說明文字　：這一行是用來控制選單呈現內容的，其意義是：先執行方括號[ ]中的find指令檢查「檔案路徑／檔案名稱」是否存在，若存在，則在選單上顯示「選單文字」的內容，並在螢幕下方(嘉義縣縣徽左邊)顯示「說明文字」；否則若是該檔案不存在，則不會顯示該段文字。而當使用者選取該「選單文字」時，便會執行[iftitle]以下的各行指令，直到遇到空行為止。
由於[find]指令在尋找檔案的過程中，會從已偵測到的實體儲存裝置分割區(A:、B:、C:、D:、E:、F:...)一路找下去，所以在指令之後還包含了幾個參數：--ignore，告訴系統不要去找軟碟(floppies)及光碟(cd)，以免拖慢開機速度；--set-root，一旦找到指定的檔案後，便將該磁碟分割區指定為開機時的「根(root)」目錄。

hide (hd0,0)　及　hide (hd0,1)：　(hdx,y)是指電腦上第x顆實體硬碟的第y個分割區(由0起算)，(hd0,0)相當於WinPE下看到的C:磁碟，而(hd0,1)則相當於D:磁碟；為了避免使用者在操作過程中損及實體硬碟中放置的VHD檔案及相關開機程式指令，在進入系統前可以先將這兩個實體硬碟分割區隱藏(hide)起來。

command (bd)/NTBOOT/NTBOOT NT6=(hd0,1)/vhdos/複本檔案.vhdx　：這一行是進入作業系統開機程序的關鍵，它的動作是開啟(hd0,1):第0號磁碟第1個分割區(D:磁碟)中，vhdos資料夾中的windows VHDx複本檔案，並進入Windows系統。假如不指定(hd0,1)的話，則系統會按照前面[find]指令的參數：「--set-root」來決定開機的根目錄。

根據上述的選單指令架構，對照使用者開機時的操作步驟，我們將5A寶寶在啟動Windows作業系統時的流程圖示如下：

第二層選單設定放在 NTBOOT 資料夾中的 vhdtool.lst 中。

## 台南版本

1. 5A88 基本程式 : win10pe_C_NTBOOT.7z
2. Win10 系統，安裝於 VHDX 虛擬磁碟檔: win10x64.7z
3. 5a88tnR 遠端遙控程式: 5a88tnR.7z

NTBOOT目錄：5a88程式、開機選單需要的檔案等。
sources目錄：「還原系統」的映像檔，也就是PE系統。
4disk.txt：5a88專用的硬碟格式化程式，需重新命名為.bat，自動格式化硬碟，並執行BOOTICEx86.exe。
BOOTICEx86.exe：開機磁區設定程式。
default、grldr：開機所需檔案。
menu.lst：開機選單，可自訂修改。
